<!-- game api stuff -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
<script src="https://unpkg.com/uuid@latest/dist/umd/uuidv1.min.js"></script>
<script src="./lib/eventmonger.js"></script>
<script src="./lib/barter.js"></script>
<script src="./lib/api.js"></script>

<!-- used for pathfinding -->
<script src="./lib/heap.js"></script>
<script src="./lib/astar.js"></script>

<script>

// once we connect spawn us a player
eventmonger.on( connectEvent, () =>  spawnPlayer() )

function getTarget() {
    // just find the first person thats not us
    for (let player of players.values()) {
        if (player != getPlayer()) return player
    }
}

function onTurn(callback) {
    // get the enemy we want to attack
    let target = getTarget()

    // is we have no target then we just wait until the next turn
    if (!target) return callback({ type: "wait" })

    // is were close enough to attack then do that
    if ( getDistance( getPlayer().position , target.position ) <= 1 ) return callback({ type: 1, target: target.id })

    // try to path find to the target
    let path = pathfind( getPlayer().position , target.position )

    // there is no path, just wait
    if ( path.length == 0 ) return callback({ type: "wait" })

    // lets move allong the path
    callback({ type: "move", ...path[0] })
}

</script>